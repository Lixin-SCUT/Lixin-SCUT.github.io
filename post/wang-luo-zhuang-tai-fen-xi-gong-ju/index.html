<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>网络状态分析工具 | Lixin-SCUT</title>
<link rel="shortcut icon" href="https://lixin-scut.github.io//favicon.ico?v=1589990054796">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://lixin-scut.github.io//styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://lixin-scut.github.io/">
  <img class="avatar" src="https://lixin-scut.github.io//images/avatar.png?v=1589990054796" alt="">
  </a>
  <h1 class="site-title">
    Lixin-SCUT
  </h1>
  <p class="site-description">
    千里之行，始于足下。不积跬步，无以至千里。
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          时间轴
        </a>
      
    
      
        <a href="/tags" class="menu">
          分类/标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              网络状态分析工具
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2020-03-16 ·
              </time>
              
                <a href="https://lixin-scut.github.io//tag/caA4UQ2wC" class="post-tag">
                  # 操作系统/Linux
                </a>
              
                <a href="https://lixin-scut.github.io//tag/3iDvZes6C" class="post-tag">
                  # 计算机网络
                </a>
              
            </div>
            
            <div class="post-content">
              <h3 id="ping">ping</h3>
<p>  ping （ Packet Internet Groper,因特网包探索器）是 Windows、UNIX 和 Linux 系统下的 一个命令。ping也属于一个通信协议，是TCP/IP协议的一部分。利用ping命令可以检查网 络是否连通，可以很好地帮助分析和判定网络故障。应用格式：<code>ping IPAddress</code>，该命令还可以加许多参数使用<br>
<img src="https://lixin-scut.github.io//post-images/1584348819311.png" alt=""><br>
  ping 发送一个 ICMP （Internet Control Messages Protocol,因特网信报控制协议），请求 消息给目的地并报告是否收到所希望的ICMP echo （ICMP回声应答），它是用来检查网络是否通畅或者网络连接速度的命令。<br>
  ping所利用的原理是这样的：利用网络上机器IP地址的唯一性，给目标IP地址发送一个数据包，再要求对方返回一个同样大小的数据包来确定两台网络机器是否连接相通以及时延是 多少。<br>
  ping指的是端对端连通，通常用来作为可用性的检查，</p>
<p>  Ping程序使用的是ICMP协议，并不具有通常所说的 TCP/UDP 端口<br>
  ICMP不像TCP或UDP有端口，但它确实含有两个域：类型(type)和代码(code)。而且这些域的作用和端口也完全不同<br>
  ping没有指定端口这个选项，它是网络层的，端口是传输层的概念。</p>
<p><strong>ping的使用</strong><br>
使用ping检查连通性有以下6个步骤。<br>
(1)使用ipconfig/all观察本地网络设置是否正确。<br>
(2) ping 127.0.0.1,来检查本地的TCP/IP协议有没有设置好。<br>
(3) ping本机IP地址，这样是为了检查本机的IP地址是否设置有误。<br>
(4) ping本网网关或本网IP地址，这样的是为了检查硬件设备是否有问题，也可以检 查本机与本地网络连接是否正常。(在非局域网中这一步骤可以忽略)<br>
(5) ping本地DNS地址，这样做是为了检查本地DNS服务器是否工作正常。<br>
(6) ping远程IP地址，这主要是检查本网或本机与外部的连接是否正常。ping远程IP 地址还可以用来测试网络延时。比如输入“pingwww.baidu.com”(百度域名)之后屏幕会显示<br>
  Linux的ping语法和Windows的差不多，但是Linux的ping数据包是64Byte,而 Windows的是32Byte, Windows下默认发送4次数据包后结束，Linux下的ping程序默认不停发送数据包，直到用户手动停止（停止指令是Ctrl+c）</p>
<h3 id="tcpdump">tcpdump</h3>
<p>  tcpdump可以将网络中传送的数据包的“头”完全截获下来提供分析。<br>
  它支持针 对协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助去掉无用 的信息。<br>
  由于它需要将网络界面设置为混杂模式，普通 用户不能正常执行，但具备root权限的用户可以直接执行它来获取网络上的信息。因此 系统中存在网络分析工具主要不会对本机安全产生威胁，而是会对网络上的其他计算机 的安全产生威胁。</p>
<p>  tcpdump根据使用者的定义对网络上的数据包进行截获和分析。<br>
  tcpdump支持相当多的不同参数，如使用-i参数指定tcpdump监听的网络界面，这在计 算机具有多个网络界面时非常有用；使用-c参数指定要监听的数据包数量，使用-w参数指 定将监听到的数据包写入文件中保存，等等。<br>
  tcpdump使用参数指定要监视数据包的类型、地址、端口等</p>
<p><strong>tcpdump使用</strong><br>
tcpdump采用命令行方式，它的命令格式为：</p>
<pre><code>tcpdump [ -adefInNOpqStvx ] [ -c 数量][-F 文件名]
[-i 网络接口 ] [ -r 文件名][-s snaplen ]
[-T类型][-w文件名][表达式]
</code></pre>
<p>  表达式是一个正则表达式，tcpdump利用它作为过滤报文的条件，如果一个报文满足表 达式的条件，则这个报文将会被捕获。如果没有给出任何条件，则网络上所有的信息包将会 被截获。在表达式中一般包含如下几种类型的关键字。<br>
1	）关于类型的关键字，主要包括host、net、port等，例如host 指明 一台主机，net 指明一个网络地址，port 指明端口号。如果没有指定类型，默认的类型是host。<br>
2	）确定传输方向的关键字，主要包括src、dst、dstorsrc、dst、src等，这些关键字 指明了传输的方向。举例说明，src指明IP包中源地址, dst net指明目的网络地址。如果没有指明方向关键字，则默认是src or dst关键字。<br>
3	）协议的关键字，主要包括fddi、ip、arp、rarp、tcp、udp等类型。如果没有指定任何协议，则tcpdump将会监听 所有协议的信息包。<br>
除了这3种类型的关键字之外，其他重要的关键字如下：gateway、broadcast、less、 greater等，还有3种逻辑运算：取非运算not/!,与运算and/&amp;&amp; ；或运算or/| | ；这些关键字可以组合起来构成强大的组合条件</p>
<p><strong>常用命令</strong><br>
1 ）截取某主机相关的包。<br>
a.	想要截获所有210.27.48.1的主机收到的和发出的所有的数据包，使用如下命令：<br>
<code>tcpdump host 210.27.48.1</code><br>
b.	想要截获主机210.27.48.1和主机210.27.48.2或210.27.48.3的通信，使用如下命令： （在命令行中使用括号时，一定要添加“\”）<br>
<code>tcpdump host 210.27.48.1 and \ (210.27.48.2 or 210.27.48.3 \）</code><br>
C.如果想要获取主机210.27.48.1除了和主机210.27.48.2之外所有主机通信的ip包，使 用如下命令：<br>
<code>tcpdump ip host 210.27.48.1 and ! 210.27.48.2</code><br>
d.如果想要获取主机210.27.48.1接收或发出的telnet包，使用如下命令：<br>
<code>tcpdump tcp port 23 host 210.27.48.1</code></p>
<p>2）	截取某端口相关的包。<br>
如果想要获取在端口 6666上通过的包，使用如下命令：<br>
<code>tcpdump port 6666</code></p>
<p>3）	截取某网卡的包。<br>
如果想要获取在网卡ethl上通过的包，使用如下命令：<br>
<code>tcpdump -iethl</code></p>
<h3 id="netstat">netstat</h3>
<p>  netstat命令用于显示与IP、TCP、UDP和ICMP协议相关的统计数据，一般用于检验本 机各端口的网络连接情况。netstat是在内核中访问网络及相关信息的程序，它能提供TCP连 接、对TCP和UDP的监听及获取进程内存管理的相关报告。</p>
<p>netstat的命令格式如下所示：<br>
netstat [-acCeFghilMnNoprstuvVwx] [-A&lt; 网络类型 &gt;][--ip]</p>
<p>  ①Active Internet connections, 称为有源TCP连接，其中Recv-Q和Send-Q指的是接收队列和发送队列，这些数字一般都 应该是0,如果不是则表示请求包和回包正在队列中堆积；<br>
  ②Active UNIX domain sockets, 称为有源UNIX域套接口<br>
  Proto显示连接使用的协议，RefCnt表示连接到本套接口上的进程号，Types显示套接口 的类型，State显示套接口当前的状态，Path表示连接到套接口的其他进程使用的路径名。<br>
常见参数如下所示：</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-a</td>
<td style="text-align:center">(all)显示所有选项，默认不显示LISTEN相关</td>
</tr>
<tr>
<td style="text-align:center">-t</td>
<td style="text-align:center">(tcp)仅显示tcp相关选项</td>
</tr>
<tr>
<td style="text-align:center">-u</td>
<td style="text-align:center">(udp)仅显示udp相关选项</td>
</tr>
<tr>
<td style="text-align:center">-n</td>
<td style="text-align:center">拒绝显示别名，能显示数字的全部转化成数字。</td>
</tr>
<tr>
<td style="text-align:center">-l</td>
<td style="text-align:center">仅列出有在Listen (监听)的服务状态</td>
</tr>
<tr>
<td style="text-align:center">-P</td>
<td style="text-align:center">显示建立相关链接的程序名</td>
</tr>
<tr>
<td style="text-align:center">-r</td>
<td style="text-align:center">显示路由信息，路由表</td>
</tr>
<tr>
<td style="text-align:center">-e</td>
<td style="text-align:center">显示扩展信息，例如uid等</td>
</tr>
<tr>
<td style="text-align:center">-s</td>
<td style="text-align:center">按各个协议进行统计</td>
</tr>
<tr>
<td style="text-align:center">-c</td>
<td style="text-align:center">每隔一个固定时间，执行该netstat命令。</td>
</tr>
</tbody>
</table>
<p>提示：LISTEN和LISTENING的状态只有用-a或者才能看到</p>
<p>使用例子</p>
<table>
<thead>
<tr>
<th style="text-align:center">功能</th>
<th style="text-align:center">命令</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">(1)列出所有端口(包括监听和未监听的)：</td>
<td style="text-align:center">netstat -ao</td>
</tr>
<tr>
<td style="text-align:center">(2)列出所有 TCP 端 口:</td>
<td style="text-align:center">netstat -ato</td>
</tr>
<tr>
<td style="text-align:center">(3)列出所有 UDP 端口 :</td>
<td style="text-align:center">netstat -auo</td>
</tr>
<tr>
<td style="text-align:center">(4)列出所有处于监听状态的socket：</td>
<td style="text-align:center">netstat -lo</td>
</tr>
<tr>
<td style="text-align:center">(5)列出所有监听 TCP 端口的 socket：</td>
<td style="text-align:center">netstat -lto</td>
</tr>
<tr>
<td style="text-align:center">(6)列出所有监听 UDP 端口的 socket:</td>
<td style="text-align:center">netstat -luo</td>
</tr>
<tr>
<td style="text-align:center">(7)歹！J 出所有监听 UNIX 端口的 socket:</td>
<td style="text-align:center">netstat -lx。</td>
</tr>
<tr>
<td style="text-align:center">(8)在netstat输出中显示PID和进程名称：</td>
<td style="text-align:center">netstat -po</td>
</tr>
<tr>
<td style="text-align:center">(9)当你不想让主机，端口和用户名显示，使用数字代替那些名称。</td>
<td style="text-align:center">netstat-n</td>
</tr>
<tr>
<td style="text-align:center">(10)持续输出 netsta 信息:</td>
<td style="text-align:center">netstat -co</td>
</tr>
<tr>
<td style="text-align:center">(11)找出程序运行的端口 ：</td>
<td style="text-align:center">netstat -ap</td>
</tr>
<tr>
<td style="text-align:center">(12)找出运行在指定端口的进程，如</td>
<td style="text-align:center">netstat -an</td>
</tr>
<tr>
<td style="text-align:center">(13)显式网络接口列表：</td>
<td style="text-align:center">netstat -io</td>
</tr>
</tbody>
</table>
<p>(14) IP和TCP的分析，如查看链接某服务端口最多的IP地址命令是：<br>
<code>netstat -nat | grep &quot;192.168.1.15:22&quot; |awk '{print $5}'|awk -F: '(print $1 }'|sort|uniq -c|sort -nr|head -20</code><br>
(15) TCP 各自状态列表： <code>netstat -nat |awk '{print $6}'</code><br>
(16)先把各种TCP状态全都取出来，然后使用uniq -c统计，之后再进行排序：  <code>netstat -nat |awk'{print $6}'|sort|uniq -c</code></p>
<p><strong>netstat 常用命令详解</strong><br>
netstat 命令：用于显示各种网络相关信息，如网络连接，路由表，接口状态，无效连接，组播成员 等等。<br>
netstat命令是net-tools软件包中的一员<br>
<img src="https://lixin-scut.github.io//post-images/1585406587816.png" alt=""></p>
<p><strong>命令行选项：</strong><br>
-a:　　列出系统中所有网络连接，包括已经连接的网络服务、监听的网络服务和Socket套接字<br>
-t：　　列出TCP数据<br>
-u：　　列出UDP数据<br>
-l：　　列出正在监听的网络服务（不包含已经连接的网路服务）<br>
-n：　　用端口显示服务，而不用服务名<br>
-p：　　列出该服务的进程ID(PID)</p>
<p><strong>互联网联机字段:</strong><br>
 Proto :网络的封包协议，主要分为 TCP 与 UDP 封包，相关资料请参考服务器篇;<br>
 Recv-Q:非由用户程序链接到此 socket 的复制的总 bytes 数;<br>
 Send-Q:非由远程主机传送过来的 acknowledged 总 bytes 数;<br>
 Local Address :本地端的 IP:port 情况<br>
 Foreign Address:远程主机的 IP:port 情况<br>
 State :联机状态，主要有建立(ESTABLISED)及监听(LISTEN);</p>
<p><strong>本地socket file 的字段:</strong><br>
 Proto :一般就是 unix ;<br>
 RefCnt:连接到此 socket 的进程数量;<br>
 Flags :联机的旗标;<br>
 Type :socket 存取的类型。主要有确认联机的 STREAM 与不需确认的 DGRAM 两种;<br>
 State :若为 CONNECTED 表示多个进程之间已经联机建立。<br>
 Path :连接到此 socket 的相关程序的路径!或者是相关数据输出的路径。</p>
<p>例子：netstat -tlunp<br>
除了可以列出监听网络的接口与状态之外，最后一个字段还能够显示此服务的PID 号码以及进程的指令名称<br>
<img src="https://lixin-scut.github.io//post-images/1585406604853.png" alt=""><br>
使用netstat -an<br>
<img src="https://lixin-scut.github.io//post-images/1585406626143.png" alt=""></p>
<p><strong>完整选项</strong></p>
<pre><code>usage: netstat [-vWeenNcCF] [&lt;Af&gt;] -r         netstat {-V|--version|-h|--help}
       netstat [-vWnNcaeol] [&lt;Socket&gt; ...]
       netstat { [-vWeenNac] -i | [-cnNe] -M | -s [-6tuw] }

      -r, --route              display routing table
        -i, --interfaces         display interface table
        -g, --groups             display multicast group memberships
        -s, --statistics         display networking statistics (like SNMP)
        -M, --masquerade         display masqueraded connections

        -v, --verbose            be verbose
        -W, --wide               don't truncate IP addresses
        -n, --numeric            don't resolve names
        --numeric-hosts          don't resolve host names
        --numeric-ports          don't resolve port names
        --numeric-users          don't resolve user names
        -N, --symbolic           resolve hardware names
        -e, --extend             display other/more information
        -p, --programs           display PID/Program name for sockets
        -o, --timers             display timers
        -c, --continuous         continuous listing

        -l, --listening          display listening server sockets
        -a, --all                display all sockets (default: connected)
        -F, --fib                display Forwarding Information Base (default)
        -C, --cache              display routing cache instead of FIB
        -Z, --context            display SELinux security context for sockets

  &lt;Socket&gt;={-t|--tcp} {-u|--udp} {-U|--udplite} {-S|--sctp} {-w|--raw}
           {-x|--unix} --ax25 --ipx --netrom
  &lt;AF&gt;=Use '-6|-4' or '-A &lt;af&gt;' or '--&lt;af&gt;'; default: inet
</code></pre>
<p><strong>例子</strong><br>
(1)已知进程名，使用命令查看当前进程打开的文件句柄?<br>
执行命令“ulimit -a”,其中oepn files 对应的即为本机文件句柄数<br>
lsof -n |awk '{print $2}'|sort|uniq -c |sort -nr|more</p>
<p>[root@study ~]# lsof [-aUu] [+d]<br>
选项与参数:<br>
-a :多项数据需要『同时成立』才显示出结果时!<br>
-U :仅列出 Unix like 系统的 socket 文件类型;<br>
-u :后面接 username，列出该使用者相关进程所开启的文件; +d :后面接目录，亦即找出某个目录底下已经被开启的文件!</p>
<p>(2)已知进程名，使用命令查看当前进程的网络连接状态?<br>
netstat -tlunp<br>
(3)已知进程名，查看 eth0 网卡与 ip10.10.10.10:10653 之间的 TCP 数据包?<br>
tcpdump -i eth0 -nn 'tcp and port 10653 and host 10.1.1.180'</p>
<h3 id="lsof">lsof</h3>
<p>  lsof (list open file)是一个列出当前系统打开文件的工具。在Linux环境下，任何事物都 以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。所以 如传输控制协议(TCP)和用户数据报协议(UDP)套接字等，系统在后台都为该应用程序分 配了一个文件描述符，无论这个文件的本质如何，该文件描述符为应用程序与基础操作系统 之间的交互提供了通用接口。因为应用程序打开文件的描述符列表提供了大量关于这个应用 程序本身的信息，因此通过lsof工具能够查看这个列表对系统监测以及排错将是很有帮助的。<br>
  在终端下输入lsof即可显示系统打开的文件，因为lsof需要访问核心内存和各种文件, 所以必须以root用户的身份运行才能够充分地发挥其功能。</p>
<p><strong>输出结果</strong><br>
(1)每行显示一个打开的文件，若不指定条件默认将显示所有进程打开的所有文件。<br>
lsof输出各列信息的意义如下所述。</p>
<ol>
<li>COMMAND：进程的名称。</li>
<li>PlD：进程标识符。</li>
<li>USER：进程所有者。</li>
<li>FD：文件描述符，应用程序通过文件描述符识别该文件如cwd、txt等。</li>
<li>TYPE：文件类型，如DlR、REG等。</li>
<li>DEVlCE：指定磁盘的名称。</li>
<li>SIZE:文件的大小。</li>
<li>NODE：索引节点(文件在磁盘上的标识)。</li>
<li>NAME：打开文件的确切名称。</li>
</ol>
<p>(2)lsof语法格式是：<br>
lsof [ options ] filename</p>
<p>(3)	常用的参数列表：</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">lsof filename</td>
<td style="text-align:center">显示打开指定文件的所有进程</td>
</tr>
<tr>
<td style="text-align:center">lsof -a</td>
<td style="text-align:center">表示两个参数都必须满足时才显示结果</td>
</tr>
<tr>
<td style="text-align:center">lsof -c strlng</td>
<td style="text-align:center">显示COMMAND列中包含指定字符的进程所有打开的文件</td>
</tr>
<tr>
<td style="text-align:center">lsof -u username</td>
<td style="text-align:center">显示所属user进程打开的文件</td>
</tr>
<tr>
<td style="text-align:center">lsof -g gld</td>
<td style="text-align:center">显示归属gld的进程情况</td>
</tr>
<tr>
<td style="text-align:center">lsof +d /DlR/</td>
<td style="text-align:center">显示目录下被进程打开的文件</td>
</tr>
<tr>
<td style="text-align:center">lsof +D /DlR/</td>
<td style="text-align:center">同上，但是会搜索目录下的所有目录，时间相对较长</td>
</tr>
<tr>
<td style="text-align:center">lsof -d FD</td>
<td style="text-align:center">显示指定文件描述符的进程</td>
</tr>
<tr>
<td style="text-align:center">lsof -n</td>
<td style="text-align:center">不将工P转换为hostname,缺省是不加上-n参数</td>
</tr>
<tr>
<td style="text-align:center">lsof -i</td>
<td style="text-align:center">用以显示符合条件的进程情况</td>
</tr>
</tbody>
</table>
<p>(4)常用命令如下所述。<br>
1 )查看6666端口现在运行情况,命令：<br>
<code>lsof -i :6666</code><br>
2)查看所属root用户进程所打开的文件，文件类型为.txt：<br>
<code>lsof -a -u root-d txt</code><br>
3)监控打开的文件和设备。查看设备/dev/ttyl被哪些进程占用的命令是:<br>
<code>lsof /dev/tty1</code><br>
4）监控程序。如查看指定程序server打开的文件：<br>
<code>lsof -c server</code><br>
5）监控用户。比如查看指定用户sharexu打开的文件：<br>
<code>lsof -u sharexu</code></p>
<h3 id="http下的工具">HTTP下的工具</h3>
<p>通过wireshark或者tcpdump抓包实现。通过前者看到的数据更加清晰直观，通过后者抓到的数据更真实。</p>
<p><a href="https://www.cnblogs.com/golinux/p/11012781.html">tcpdump抓包命令使用</a><br>
<a href="https://www.jianshu.com/p/81bc5685085b">Wireshark抓包工具的使用</a><br>
<a href="https://blog.csdn.net/sdgihshdv/article/details/80593892">使用WireShark抓包工具深入理解TCP连接的三次握手以及知识延伸</a></p>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://lixin-scut.github.io//post/linux-diao-shi-gong-ju">
              <h3 class="post-title">
                Linux调试工具
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '253c8689f3b11b51dcf1',
    clientSecret: '64df7c097665e7dd6f416ecfaba36581a91bdb63',
    repo: 'Lixin-SCUT.github.io',
    owner: 'Lixin-SCUT',
    admin: ['Lixin-SCUT'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://lixin-scut.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
