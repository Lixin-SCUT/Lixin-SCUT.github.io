<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Git - 分支管理 | Lixin-SCUT</title>
<link rel="shortcut icon" href="https://lixin-scut.github.io//favicon.ico?v=1589208865131">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://lixin-scut.github.io//styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://lixin-scut.github.io/">
  <img class="avatar" src="https://lixin-scut.github.io//images/avatar.png?v=1589208865131" alt="">
  </a>
  <h1 class="site-title">
    Lixin-SCUT
  </h1>
  <p class="site-description">
    千里之行，始于足下。不积跬步，无以至千里。
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          时间轴
        </a>
      
    
      
        <a href="/tags" class="menu">
          分类/标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Git - 分支管理
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2020-05-11 ·
              </time>
              
                <a href="https://lixin-scut.github.io//tag/FaScKSk5i" class="post-tag">
                  # 读书笔记
                </a>
              
                <a href="https://lixin-scut.github.io//tag/g3aPuoYWw" class="post-tag">
                  # Github
                </a>
              
            </div>
            
            <div class="post-content">
              <p>分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p>
<p>现在有了分支，就不用怕了。你<strong>创建了一个属于你自己的分支</strong>，别人看不到，还<strong>继续在原来的分支上正常工作</strong>，而你在自己的分支上干活，想提交就提交，直到<strong>开发完毕后，再一次性合并到原来的分支上</strong>，这样，既安全，又不影响别人工作。</p>
<p>其他版本控制系统如SVN等都有分支管理，但是用过之后你会发现，这些版本控制系统创建和切换分支慢，结果分支功能成了摆设，大家都不去用。</p>
<p>但Git的分支是与众不同的，无论创建、切换和删除分支，Git在1秒钟之内就能完成！无论你的版本库是1个文件还是1万个文件。</p>
<h2 id="创建与合并分支">创建与合并分支</h2>
<h3 id="分支概念">分支概念</h3>
<p>在版本回退里，每次提交Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫<strong>主分支，即master分支</strong>。<strong>HEAD严格来说不是指向提交，而是指向master</strong>，master才是指向提交的，所以，HEAD指向的就是当前分支。</p>
<p>一开始的时候，<strong>master分支是一条线</strong>，Git<strong>用master指向最新的提交</strong>，<strong>再用HEAD指向master</strong>，就能确定当前分支，以及当前分支的提交点：<br>
<img src="https://lixin-scut.github.io//post-images/1589204783529.png" alt=""></p>
<p><strong>每次提交，master分支都会向前移动一步</strong>，这样，随着你不断提交，master分支的线也越来越长。</p>
<p>当我们<strong>创建新的分支，例如dev时</strong>，Git<strong>新建了一个指针叫dev</strong>，指向master相同的提交，<strong>再把HEAD指向dev</strong>，就表示当前分支在dev上：<br>
<img src="https://lixin-scut.github.io//post-images/1589204824262.png" alt=""></p>
<p>你看，Git创建一个分支很快，因为<strong>除了增加一个dev指针，改改HEAD的指向，工作区的文件都没有任何变化</strong>！</p>
<p>不过，<strong>从现在开始，对工作区的修改和提交就是针对dev分支了，比如新提交一次后，dev指针往前移动一步，而master指针不变</strong>：</p>
<p><img src="https://lixin-scut.github.io//post-images/1589204958791.png" alt=""></p>
<p>假如我们在dev上的工作完成了，就可以把dev合并到master上。Git怎么合并呢？最简单的方法，就是直接把master指向dev的当前提交，就完成了合并：<br>
<img src="https://lixin-scut.github.io//post-images/1589204995130.png" alt=""></p>
<p><strong>所以Git合并分支也很快！就改改指针，工作区内容也不变！</strong></p>
<p>合并完分支后，甚至可以删除dev分支。<strong>删除dev分支就是把dev指针给删掉</strong>，删掉后，我们就剩下了一条master分支：</p>
<p><img src="https://lixin-scut.github.io//post-images/1589205086707.png" alt=""></p>
<h3 id="创建分支">创建分支</h3>
<p>首先，我们创建dev分支，然后切换到dev分支：</p>
<pre><code>$ git checkout -b dev

Switched to a new branch 'dev'
</code></pre>
<p><strong>git checkout命令加上-b参数表示创建并切换</strong>，相当于以下两条命令：</p>
<pre><code>$ git branch dev
$ git checkout dev
Switched to branch 'dev'
</code></pre>
<p>然后，用git branch命令查看当前分支：</p>
<pre><code>$ git branch
* dev
  master
</code></pre>
<p>git branch命令会列出所有分支，当前分支前面会标一个*号。</p>
<p>然后，我们就可以在dev分支上正常提交，比如对readme.txt做个修改，加上一行：</p>
<pre><code>Creating a new branch is quick.
</code></pre>
<p>然后提交：</p>
<pre><code>$ git add readme.txt 
$ git commit -m &quot;branch test&quot;
[dev b17d20e] branch test
 1 file changed, 1 insertion(+)
</code></pre>
<p>现在，dev分支的工作完成，我们就可以切换回master分支：</p>
<pre><code>$ git checkout master
Switched to branch 'master'
</code></pre>
<p><strong>切换回master分支后，再查看一个readme.txt文件，刚才添加的内容不见了</strong>！因为那个提交是在dev分支上，而<strong>master分支此刻的提交点并没有变</strong>：<br>
<img src="https://lixin-scut.github.io//post-images/1589205993805.png" alt=""></p>
<h3 id="合并分支">合并分支</h3>
<p>现在，我们把dev分支的工作成果合并到master分支上：</p>
<pre><code>$ git merge dev
Updating d46f35e..b17d20e
Fast-forward
 readme.txt | 1 +
 1 file changed, 1 insertion(+)
</code></pre>
<p><strong>git merge命令用于合并指定分支到当前分支</strong>。合并后，再查看readme.txt的内容，就可以看到，和dev分支的最新提交是完全一样的。</p>
<p>注意到上面的<strong>Fast-forward信息</strong>，Git告诉我们，这次<strong>合并是“快进模式”</strong>，也就是<strong>直接把master指向dev的当前提交，所以合并速度非常快</strong>。</p>
<p>当然，<strong>也不是每次合并都能Fast-forward</strong>，我们后面会讲其他方式的合并。</p>
<h3 id="删除分支">删除分支</h3>
<p>合并完成后，就可以放心地<strong>删除dev分支</strong>了：</p>
<pre><code>$ git branch -d dev
Deleted branch dev (was b17d20e).
</code></pre>
<p>删除后，查看branch，就只剩下master分支了：</p>
<pre><code>$ git branch
* master
</code></pre>
<p>因为<strong>创建、合并和删除分支非常快</strong>，所以Git<strong>鼓励你使用分支完成某个任务，合并后再删掉分支</strong>，这和直接在master分支上工作效果是一样的，但<strong>过程更安全</strong>。</p>
<h3 id="switch">switch</h3>
<p>我们注意到切换分支使用<code>git checkout &lt;branch&gt;</code>，而前面讲过的撤销修改则是<code>git checkout -- &lt;file&gt;</code>，同一个命令，有两种作用，确实有点令人迷惑。</p>
<p>实际上，<strong>切换分支这个动作，用switch更科学</strong>。因此，最新版本的Git提供了新的git switch命令来切换分支：</p>
<p>创建并切换到新的dev分支，可以使用：</p>
<pre><code>$ git switch -c dev
</code></pre>
<p>直接切换到已有的master分支，可以使用：</p>
<pre><code>$ git switch master
</code></pre>
<p>使用新的git switch命令，比git checkout要更容易理解。</p>
<h3 id="小结">小结</h3>
<p>Git鼓励大量使用分支：</p>
<p>查看分支：<code>git branch</code></p>
<p>创建分支：<code>git branch &lt;name&gt;</code></p>
<p>切换分支：<code>git checkout &lt;name&gt;</code>或者<code>git switch &lt;name&gt;</code></p>
<p>创建+切换分支：<code>git checkout -b &lt;name&gt;</code>或者<code>git switch -c &lt;name&gt;</code></p>
<p>合并某分支到当前分支：<code>git merge &lt;name&gt;</code></p>
<p>删除分支：<code>git branch -d &lt;name&gt;</code></p>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://lixin-scut.github.io//post/git-yuan-cheng-cang-ku">
              <h3 class="post-title">
                Git - 远程仓库
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '253c8689f3b11b51dcf1',
    clientSecret: '64df7c097665e7dd6f416ecfaba36581a91bdb63',
    repo: 'Lixin-SCUT.github.io',
    owner: 'Lixin-SCUT',
    admin: ['Lixin-SCUT'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://lixin-scut.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
